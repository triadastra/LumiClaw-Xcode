<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="520" viewBox="0 0 1200 520" role="img" aria-labelledby="title desc">
  <title id="title">Apple Health sync flow</title>
  <desc id="desc">Flow showing iOS HealthKit authorization, local JSON export, and bidirectional sync to macOS app.</desc>
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#fffaf5"/>
      <stop offset="100%" stop-color="#fff1f2"/>
    </linearGradient>
    <style>
      .title { font: 700 32px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; fill:#111827; }
      .subtitle { font: 500 16px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; fill:#374151; }
      .step { font: 700 16px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; fill:#111827; }
      .body { font: 500 13px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; fill:#374151; }
      .pill { font: 700 12px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; fill:#7f1d1d; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L9,3 L0,6 z" fill="#6b7280"/>
    </marker>
  </defs>

  <rect x="0" y="0" width="1200" height="520" fill="url(#bg)" rx="24"/>
  <text x="44" y="58" class="title">Apple Health Sync Pipeline</text>
  <text x="44" y="86" class="subtitle">iOS fetches locally, persists JSON, then syncs to macOS for dashboard + AI analysis.</text>

  <rect x="44" y="130" width="250" height="120" rx="14" fill="#ffffff" stroke="#fca5a5"/>
  <text x="64" y="165" class="step">1) iOS Health Access</text>
  <text x="64" y="190" class="body">Request HealthKit permission</text>
  <text x="64" y="210" class="body">Read activity, heart, sleep, body,</text>
  <text x="64" y="229" class="body">workouts, vitals</text>

  <rect x="334" y="130" width="250" height="120" rx="14" fill="#ffffff" stroke="#fdba74"/>
  <text x="354" y="165" class="step">2) Local iOS Processing</text>
  <text x="354" y="190" class="body">Analyze in iOS Health tab</text>
  <text x="354" y="210" class="body">Export JSON to Files app</text>
  <text x="354" y="229" class="body">Persist `health_data.json`</text>

  <rect x="624" y="130" width="250" height="120" rx="14" fill="#ffffff" stroke="#93c5fd"/>
  <text x="644" y="165" class="step">3) Bidirectional Sync</text>
  <text x="644" y="190" class="body">Remote tab sync loop</text>
  <text x="644" y="210" class="body">Push + pull JSON files</text>
  <text x="644" y="229" class="body">Timestamp conflict checks</text>

  <rect x="914" y="130" width="250" height="120" rx="14" fill="#ffffff" stroke="#86efac"/>
  <text x="934" y="165" class="step">4) macOS Health Dashboard</text>
  <text x="934" y="190" class="body">Read synced health_data.json</text>
  <text x="934" y="210" class="body">Display metrics + trends</text>
  <text x="934" y="229" class="body">Run AI insights locally</text>

  <line x1="294" y1="190" x2="334" y2="190" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrow)"/>
  <line x1="584" y1="190" x2="624" y2="190" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrow)"/>
  <line x1="874" y1="190" x2="914" y2="190" stroke="#6b7280" stroke-width="2.5" marker-end="url(#arrow)"/>

  <rect x="44" y="294" width="1120" height="170" rx="14" fill="#ffffff" stroke="#e5e7eb"/>
  <text x="66" y="328" class="step">Files included in sync</text>
  <text x="66" y="355" class="body">agents.json • conversations.json • automations.json • sync_settings.json • sync_api_keys.json • health_data.json</text>

  <text x="66" y="395" class="body">Health-specific behavior:</text>
  <text x="90" y="419" class="body">• iOS prefetches HealthKit before each sync cycle when `settings.syncHealth` is enabled.</text>
  <text x="90" y="441" class="body">• iOS keeps a persisted health payload so sync still works after app restarts.</text>

  <rect x="872" y="336" width="272" height="32" rx="16" fill="#fee2e2"/>
  <text x="886" y="357" class="pill">privacy: health processing remains local to your devices</text>
</svg>
